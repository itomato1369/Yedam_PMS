<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" th:href="@{/css/dynamic-search.css}" />
<!-- Bootstrap5 icon사용 -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker.min.css" />

<!-- 1. jQuery = JavaScript 라이브러리-->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- 2. bootstrap-datepicker 본체 -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/js/bootstrap-datepicker.min.js"></script>
<!-- 3. 한국어 캘린더-->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/locales/bootstrap-datepicker.ko.min.js"></script>

<title>소요시간 보고서</title>
</head>
<body>
	<div class="container">
		<div class="mb-3">
			<label class="fw-bold fs-4">소요시간 보고서 조회</label>
		</div>

		<!-- 검색조건  -->
		<form th:action="@{/work/report}" method="get" id="reportSearchForm">
			<div id="dynamicReportSearch" class="row g-3 mb-3">
				<div
					th:replace="~{common/fragments/work/dynamic-work-report-search}"></div>
			</div>

			<!-- 검색조건 추가 버튼 + 조회버튼 -->
			<div
				class="mb-3 d-flex align-items-stretch justify-content-end gap-2">
				<div class="dropdown me-2">
					<button class="btn btn-secondary dropdown-toggle" type="button"
						data-bs-toggle="dropdown">검색조건 추가</button>
					<ul class="dropdown-menu">
						<li><a class="dropdown-item add-condition" href="#"
							data-target="field-job">일감별</a></li>
						<li><a class="dropdown-item add-condition" href="#"
							data-target="field-project">프로젝트별</a></li>
						<li><a class="dropdown-item add-condition" href="#"
							data-target="field-users">사용자별</a></li>
						<li><a class="dropdown-item add-condition" href="#"
							data-target="field-projectWeek">프로젝트 주별</a></li>
						<li><a class="dropdown-item add-condition" href="#"
							data-target="field-projectMonth">프로젝트 월별</a></li>
					</ul>
				</div>
				<!-- 조회 버튼 -->
				<button type="submit" class="btn btn-primary">조회</button>
				<!-- 소요시간 조회로 이동-->
				<a th:href="@{/work/list}"
					class="btn btn-success text-white 
				d-inline-flex align-items-center justify-content-center">소요시간
					조회</a>
			</div>
		</form>
		<!-- 보고서로 조회되는 테이블 -->
		<div th:if="${reportList != null}" class="mt-4">
			<table class="table table-hover text-center">
				<thead class="table=light">
					<tr>
						<th
							th:if="${reportType == 'project'
						or reportType == 'week' or reportType == 'month'}"
							class="bi bi-folder2-open me-1">프로젝트</th>
						<th th:if="${reportType == 'users'}"
							class="bi bi-person-badge me-1">사용자</th>
						<th th:if="${reportType == 'job'}"
							class="bi bi-card-checklist me-1">일감</th>
						<th class="bi bi-calendar-range me-1">기간</th>
						<th class="bi bi-alarm me-1">예상시간</th>
						<th class="bi bi-play0circle me-1">실제 작업시간</th>
						<th class="bi bi-graph-up me-1">진척률</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="row : ${reportList}">
						<td class="text-satrt"><span th:if="${reportType == 'job'}"
							th:text="'[' + ${row.projectName} + '] ' + ${row.title}"></span> <span
							th:if="${reportType != 'job' and reportType != 'users'}"
							th:text="${row.projectName}"></span> <span
							th:if="${reportType == 'users'}"
							th:text="${row.userId} + ' (' + ${row.projectName} + ')'"></span>
						</td>
						<td><span th:if="${reportType == 'week'}"
							th:text="${row.workWeek}"></span> <span
							th:if="${reportType == 'month'}" th:text="${row.workMonth}"></span>
							<span
							th:if="${reportType == 'job' or
								reportType == 'project' or reportType == 'users'}"
							th:text="${#dates.format(row.startDate, 'yyyy-MM-dd')} + 
								' ~ ' + ${#dates.format(row.endDate, 'yyyy-MM-dd')}"></span>
						</td>
						<td
							th:text="${row.estimatedTime ?: row.averageTime}
							+ '시간'"></td>
						<td class="fw-bold text-primary"
							th:text="${row.realWorkTime} + '시간'"></td>
						<td style="width: 150px;">
							<div class="progress" style="height: 10px;">
								<div class="progress-bar" role="progressbar"
									th:with="total=${row.estimatedTime ?: row.averageTime ?: 1}, percent=${(row.realWorkTime * 1.0 / total) * 100}"
									th:style="'width: ' + (${percent > 100 ? 100 : percent}) + '%'"
									th:classappend="${percent > 100 ? 'bg-danger' : 'bg-success'}"></div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script th:src="@{/js/work/workReport.js}"></script>
</body>
</html>
