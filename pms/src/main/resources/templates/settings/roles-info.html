<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layouts/default-layout}">

<head>
    <title>역할 상세 설정</title>
</head>

<body>
    <div layout:fragment="Content">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 id="roleTitle">역할 상세 설정 <small class="text-muted" id="roleIdText"></small></h3>
                <button type="button" class="btn btn-secondary" onclick="history.back()">
                    <i class="cil-arrow-left"></i> 뒤로가기
                </button>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-header fw-bold">기본 정보</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">역할 명칭</label>
                                <input type="text" id="roleNameInput" class="form-control" readonly>
                            </div>
                            </div>
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span class="fw-bold">메뉴별 접근 권한 설정</span>
                            <button type="button" id="btnSavePermissions" class="btn btn-primary btn-sm">저장</button>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-hover align-middle mb-0 text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>메뉴명</th>
                                        <th>읽기</th>
                                        <th>쓰기</th>
                                        <th>삭제</th>
                                    </tr>
                                </thead>
                                <tbody id="permissionTableBody">
                                    <tr>
                                        <td colspan="4" class="py-5 text-center text-muted">데이터를 불러오는 중입니다...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            $(document).ready(function () {
                // 1. URL 파라미터에서 menu_id(roleNo) 추출
                const urlParams = new URLSearchParams(window.location.search);
                const roleNo = urlParams.get('menu_id');

                if (!roleNo) {
                    alert("잘못된 접근입니다.");
                    location.href = "/settings"; // 목록으로 튕겨내기
                    return;
                }

                // 2. 초기 데이터 로드
                const init = () => {
                    loadRoleDetail();
                    // loadPermissions(); // 권한 목록이 필요하다면 추가 호출
                };

                // 3. 역할 정보 조회
                const loadRoleDetail = () => {
                    $.get(`/settings/api/roles/${roleNo}`, function(data) {
                        if(data) {
                            $('#roleIdText').text(`(ID: ${data.roleNo})`);
                            $('#roleNameInput').val(data.roleName);
                            $('#roleTitle').html(`${data.roleName} <small class="text-muted">(상세 설정)</small>`);
                        }
                    }).fail(() => alert("역할 정보를 불러오는 데 실패했습니다."));
                };

                // 4. 저장 버튼 이벤트
                $('#btnSavePermissions').on('click', function() {
                    // 권한 저장 로직 작성
                    alert("설정이 저장되었습니다.");
                });

                init();
            });
        </script>
    </div>
</body>
</html>